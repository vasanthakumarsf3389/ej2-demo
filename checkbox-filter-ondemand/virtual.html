<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CheckBox/Excel Filter On Demand Virtual Scroll</title>
    <script src="https://ej2.syncfusion.com/javascript/demos/grid/local-data/datasource.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css">
    <link href="https://cdn.syncfusion.com/ej2/20.4.48/material.css" rel="stylesheet">
    <style>
        .e-excelfilter .e-virtual-list {
            margin-top: 0;
            overflow-y: hidden;
        }

        .e-grid .e-checkboxlist.e-virtual-list {
            margin-top: 0;
            overflow-y: unset;
            height: fit-content;
            min-height: 200px;
            will-change: transform;
            z-index: 1;
        }
    </style>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script> 
    <script src="./ej2.min.js"></script>
    <script>
        function load() {
            document.body.lastElementChild.remove();
        }
    </script>
</head>
<body onload="load()">
    <div>
        <div class="div-button">
            <button id="genarate" class="e-info"> Load 100K Data</button>
            <span id="popup">
                <span id="gif" class="image"></span>
            </span>
            <span id="performanceTime">Time Taken: 0 ms</span>
        </div>
        <h4 style="display: inline-block;">Filter Choice Count: </h4>
        <input type="text" id="filterchoice">
        <h4 style="display: inline-block;">S.No => Custom Data Count: </h4>
        <input type="text" id="customdata">
        <h4 style="display: inline-block;">Enable Checkbox filter virtualization: </h4>
        <input type="checkbox" tabindex="1" id='dataloadtype'/>
        <h4 style="display: inline-block;">Checkbox Loading indicator: </h4>
        <input type="text" id='loadingeffect'/>
        <h4 style="display: inline-block;">Filter Type: </h4>
        <input type="text" tabindex="1" id='filterType' />
        <h3>Once change filter type, filtered value will be cleared.</h3>
        <!-- or mode of data load -->
        <div id="Grid">
        </div>
    </div>
    <script>
        var date1;
    var date2;
    var flag = true;
    var genarateData = new ej.buttons.Button({}, '#genarate');
    var defaultColumns = [
        { type: 'CheckBox' },
        {
            field: 'SNo',
            headerText: 'S.No',
            width: 140,
            isPrimaryKey: true,
            validationRules: { required: true, digits: true }
        },
        {
            field: 'FIELD1',
            headerText: 'Player Name',
            width: 140,
            validationRules: { required: true }
        },
        { field: 'FIELD2', headerText: 'Year', width: 120, textAlign: 'Right' },
        {
            field: 'FIELD3',
            headerText: 'Sports',
            width: 160,
            textAlign: 'Right',
            editType: 'dropdownedit',
            validationRules: { required: true }
        },
        {
            field: 'FIELD4',
            headerText: 'Country',
            width: 160,
            textAlign: 'Right',
            editType: 'dropdownedit'
        },
        { field: 'FIELD5', headerText: 'LGID', width: 120, textAlign: 'Right' },
        { field: 'FIELD6', headerText: 'GP', width: 120, textAlign: 'Right' },
        { field: 'FIELD7', headerText: 'GS', width: 120, textAlign: 'Right' },
        { field: 'FIELD8', headerText: 'Minutes', width: 120, textAlign: 'Right' },
        { field: 'FIELD9', headerText: 'Points', width: 120, textAlign: 'Right' },
        { field: 'FIELD10', headerText: 'OREB', width: 130, textAlign: 'Right' },
        { field: 'FIELD11', headerText: 'DREB', width: 130, textAlign: 'Right' }
    ];
    
    var choiceDataList = [
        { text: '20', value: 20 },
        { text: '25', value: 25 }
    ];
    var filterChoiceDD = new ej.dropdowns.DropDownList({
        dataSource: choiceDataList,
        text: '20',
        value: 20,
        fields: { text: 'text', value: 'value' },
        width: 200
    });
    filterChoiceDD.appendTo('#filterchoice');
    var enableVirtualLoad = new ej.buttons.CheckBox();
    enableVirtualLoad.checked = true;
    enableVirtualLoad.appendTo('#dataloadtype');
    document.getElementById('dataloadtype').onclick = () => {
    if (enableVirtualLoad.checked) {
            grid.filterSettings.enableVirtualization = true;
            filterChoiceDD.value = 20;
        } else {
            grid.filterSettings.enableVirtualization = false;
            filterChoiceDD.value = null;
        }
        // grid.clearFiltering();
    };
    var customDataList = [
        { text: '100000', value: 100000 },
        { text: '10000', value: 10000 },
        { text: '1000', value: 1000 }
    ];
    var customDataDD = new ej.dropdowns.DropDownList({
        dataSource: customDataList,
        text: '100000',
        value: 100000,
        fields: { text: 'text', value: 'value' },
        width: 200
    });
    customDataDD.appendTo('#customdata');
    var loadingEffectList = [
        { text: 'Shimmer', value: 'Shimmer' },
        { text: 'Spinner', value: 'Spinner' }
    ];
    var loadingEffectDD = new ej.dropdowns.DropDownList({
        dataSource: loadingEffectList,
        text: 'Shimmer',
        value: 'Shimmer',
        width: 200,
        change: function (e) {
            var dropSelectedValue = e.value;
            grid.filterSettings.loadingIndicator = dropSelectedValue;
        }
    });
    loadingEffectDD.appendTo('#loadingeffect');
    var filtertype = [
        { id: 'CheckBox', type: 'CheckBox' },
        { id: 'Excel', type: 'Excel' }
    ];
    var dropDownFilterType = new ej.dropdowns.DropDownList({
        dataSource: filtertype,
        fields: { text: 'type', value: 'id' },
        value: 'Excel',
        width: 200,
        change: function (e) {
            var dropSelectedValue = e.value;
            grid.filterSettings.type = dropSelectedValue;
            grid.clearFiltering();
        }
    });
    dropDownFilterType.appendTo('#filterType');
    var data = [];
    genarateData.element.onclick = function () {
        if (!data.length) {
            show();
            dataSource();
            date1 = new Date().getTime();
            grid.dataSource = data = virtualData;
        }
    };
    var grid = new ej.grids.Grid({
        dataSource: [],
        enableVirtualization: true,
        autoFit: true,
        enableColumnVirtualization: true,
        allowFiltering: true,
        allowSorting: true,
        filterSettings: {
            type: dropDownFilterType.value,
            loadingIndicator: loadingEffectDD.value,
            enableVirtualization: true,
        },
        height: 450,
        rowHeight: 38,
        pageSettings: { pageSize: 25 },
        // width: 630,
        editSettings: {
            allowEditing: true,
            allowAdding: true,
            allowDeleting: true,
            mode: 'Normal',
            newRowPosition: 'Bottom'
        },
        toolbar: ['Add', 'Edit', 'Delete', 'Update', 'Cancel'],
        columns: defaultColumns,
        dataBound: hide,
        actionBegin: function (args) {
            if (args.requestType === 'filterchoicerequest') {
                args.filterChoiceCount = filterChoiceDD.value;
            }
            else if (args.requestType === 'filterbeforeopen' && args.columnName === "SNo") {
                // Assign custom data source to the filter module data source
                args['filterModel'].options.dataSource = virtualData.slice(0, customDataDD.value);
                // // Remove filtered field except custom data source field
                // args['filterModel'].options.filteredColumns = args['filterModel'].options.filteredColumns.filter( function(col: Column) {
                //     if (col.field == "SNo") {
                //            return true;
                //     }
                //     return false;
                // });
            }
        },
    });
    grid.appendTo('#Grid');
    grid.element.classList.contains('');
    function show() {
        document.getElementById('popup').style.display = 'inline-block';
    }
    function hide() {
        if (flag && date1) {
            var date2_1 = new Date().getTime();
            document.getElementById('performanceTime').innerHTML =
                'Time Taken: ' + (date2_1 - date1) + 'ms';
            grid.editSettings.allowAdding = true;
            flag = false;
            genarateData.disabled = true;
        }
        document.getElementById('popup').style.display = 'none';
    }
    </script>
</body>
</html>